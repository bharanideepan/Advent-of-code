const data = `...................................................................................................................................
...#........#..#.#....#.....#..........#......#..........#...........................#.................#...#.#.....................
................#....#.........#.#...#............#..#....#..................##..........#........#.....#....###..#....#...........
.#...........##..............#...#.........#..............#.................#...............#...................................##.
..#...........#...........##....##.............#.....#.........................#................#..........................#.......
..............#......................#...........#..#...#......................#.............#.......#.............................
...........#..#..............#.#.....#...........................................#.....###..............#.#..............#.......#.
.......#....#............#......#....#.............................................#.....#.........................................
....##.........##......##.........##.........#....#............#.............#...#..#....#...................#.........#.#.........
..#...........#...#.#.........................................................#.....#.#...#.####.......##...................#...#..
.......#....##...................#..#......#....#...................#..........#...............#.............#.......#..#..........
.................#.#.#####....#....#....##.#...............#...#.....#.#..............#...................#...#................#...
...........................#.....#...#.......................#....##.....................##....#..#..#.............................
...#.#...............................................................#.#................#.#.......................#................
....##.................................#.#.....#......................#....................#........#.................#.#..#.......
.....#.........#.#...#..........#..#.#......#........................................#.................#..........#.##..........#..
.........#......#....#..#...................#............................#.............................#...#.......#...............
.#.#.........#...#..........#..#.........#..#...............##......##...#...........................#........#....................
......#......................#.........#....................#.#............#.#............#.............#........#...#.#.........#.
........#....#..................#......................#......#.#.......#..............................##...............#..........
.#.......#...#.#..#..................................#............#..#...#..................#.#...#.#..............#...#.....#.....
..#.....#...##..#......#.......#......#..............#....#..........#..........#.#.............#.....#.......#...#..###.##........
...................#..#.....#.......................#.......#............#.....#..#.........#....#....#....#.................#.....
........#.......###....##.......#.....#........#........#..##.....#.......##...#...#........#..............#.#.....................
...............#......##..............................#............#..........#...###...................#.#..................#.....
..#...#..#.#.#.#..........#.#...#..#.....................#..#.....#...........#...............#..............#..#..........#..#....
........#........#..#.......##.##..........##................##............#........#...........................#..#...#...##...#..
......#.#..#..#..........#.#...................#......#..............#.....#...........#..............##...........#...............
.....#...#...#.......##...........................#................#....#............#...........#.....#......#........##..........
..#.#........#..#.#...#.....#............#..................................#.............#................##....##................
......#.......#......#..........................#.........#.#.............#..#.......#...................#..#......................
......................#..................#.............#...#................#..........................#.##........#....#..........
..#....#.##...............#.............#.............................#.#..###.#...........#............................#..........
.....................................#.....#...#...#..#........#.....................#.#..#...#........#.....#.................#.#.
.....................#.....................#........................#..........#...#.....#..............#......#.................#.
.........#...#......#..#......................#.........#............#.........#........................#...#..###.#.....#..#......
.............#..#.......#..........#.............#.#...#.#.#....#...........#......................................................
.....##....#.......................#......................#...#.#..............................#..................##..#............
.....#.........#..........................#.........#.............#...#....#............#....#...............#...#..##.........#...
..#................................#......##..##..#.......#..#..................#.....................................#.#...#......
.....................#..........#.#...........#..............#.............#.#......................#...........#.###..............
......##.#.#.............................##........#.............................#.....#.....#.......................#.............
................#..............................#....#...................#.##......#...................#...........#....##..........
.#............#.....................#.....#...............................#.#.........#.............#...#........#.................
.#.........##...................##..............#..........#.#................#.......................#........................#...
..#............#.................#..............#..........##.....#..##..........#............#.......................#............
....#.#.......#.........#.............#.......#......##....#............#................#........#................#..........#....
..............................#....###......#..#..#....................##..........#.#.##.......#.........................#...##...
........#............#...##.....................##..#......##......#..........#......#...............................#.#...#.......
.....#.#.#............#....#....#.....#.......#.#....#.........#......#..................#.#..#..........................#.........
.........#...........................#.....#..#.......#.....#...#........#......#...................#.........#....................
....#....#............#........#..................#.......................#..#.##..............#................#..........#.......
...###...............##..............#.......##..#.#.....#.....#.......#...#.......##......................##...#...........#.#....
.......................#.....#.........#..........#......#...............#.....#.....#....#.........#..#.........#.................
................................................#.#.#....#......#...#..............#........#.#....#..........#.............#......
.#....#..................#.....#...#.......#......................#..#.........................#..#...........##....#..............
.....................##................#.#....#......#......#......#....#...#....................#..........##.....................
....#................#....#..........#.#.....................#.......#...#......#........#.#.#..........#...........#..........#.#.
..#..................#.................#..#....#.#.#.....#.#...#.......#..#......................#...................#.............
..#.............##.........#..#.......#......#.............#................##..................#...#......#............#..........
............#.....##.............#..#...#....###...#.........................#..#.#........#..................#......#.............
....................#.#........#.......#.........#....##......##....#...#.#.##.#..#...#...............#...#.......#....#...........
..................................#...#.........#..............#........#.............#...........................#.......#........
..............##.......#.............#.#.........#..#.#.....................#.......................##...##..#.........#...........
..........#.....#.#..##....#..................#....#.......#............#.........#...#........#..................#.......#........
.................................................................S.................................................................
..............##.#.....................#...........##..##.......#............#....#.#.........#..#.....................##...#......
...........................#.#...##..##............#......#............#...........#.#.#......#...#......................#.........
....................#...........#...........#.........#.......................#.........#......##...........#...........#..........
..................#......#.........................#.....###.......#................#..#.........#.........####..........#.........
.................#......#....................#.#.#..........###.......................#...#.......#...#................#.#.........
.......................#..#........#..##...#...........#.......#.......................#............#...#.....#.#..................
...............#.....................#..#..#................#.#...........#...#......#......#..#.....#.........#.......#...........
.#.................#........#.........#......#.....................#......................#..........................#..........#..
................##......#..........#.....#..........#.........#....................#....#...........#..#.....#.....................
.......................................#.......................#......#...........................#...#............................
..............................#..............................#.....#...............#..............#...#....#................#....#.
...#..#...........#...........##........##...........#.#.......................#..........#.#.......#...#..................##......
.....#.............##........#.#.#.............#.......#............#.....#.........#.............#......................#...#.#...
........#.....................#..........#......................#.............#.#.............#........#...........................
..........................#..........#...............#.............#.....##...#.#......#.........#.......#.............#...........
.#.....#..........................#.#..#..#..............#................#.............##..................................#......
...........#...................##.........................#.....#......#...#....#...............#............#.............##.#....
...#...........................#................#..#......#...#.............#..#.....#.............................................
.......##..#..............#.#....................#.....#.............#....................#............#.#....................##...
.##.#..........#........#.....................#.#.......#..#..#..........##...........................................#.......#....
..............#..#........#......#.................#.....#.........#.......#..............#..........##.....................#......
...........#...#.............#........#......#........#.........#......#.....#.....#....................#...........#..........#...
.#...............................#...#.....#.##........#............#...#...#..#................#.......................##.......#.
.........#.#...............................................#...#.....#.........................................#....#..............
.....#..#...#...................#................#......#.#....................#......#...#.....#............#.......#..........#..
..............#.....................#.....................................#.......#..#......#..................#.......#.....#.....
....#....#...#...##................#..#.......#..#................#..#..............#...........#..........#.##......#....#...#.#..
...#........#.........#..........#..#......#.....#..........................#........#................................#............
.........#........#..................................#..........................#.........................#....#......#............
.#..................................................#....##....#....#...#..#...#..........#.......................#................
........#...#............................##.........................#.....#...##...#.........#............#.........#..............
...#.#.......#.......................#.....#..............#...#.............#...#......................................#...#....#..
....#.......#..#......................##...#....##....#............#.........................................#.....................
.......#....................#.........#...............#.....#.#....#................#...#................#........#................
..#...#....#......#......#....#........#..##....#....##..#..##.#..#.....................#..........#.......#................##.....
......#.#............#....................#.....#...............#...#...............#...............###.#......#.........##........
..................#........................##..#.......#....#......#.................#.............#......#....#....#......#...#...
...#..#.......#....#...........#.....................#......................#..........#..........#........##......................
.....##.....#.....#...#...#..........................##....................##..#.....................#......##.........#.....#.....
....##.......##.#..#..#.........#...#.............#.....#..................................................#.#.........#....#......
..........#..#.##..............#.................#..............#......#.#.##.......#.........................#....#.............#.
...........#.......................#..............#..##.....#...#.#.........................................##........#....#.....#.
..............#..#...................................#...................#.....#..............#...........#.........#..#...........
..........#.#...................#...............#.....................#..........#.........................#.#.....................
........##...#......#.#...##..#.....#................#............#........#....#..............#....#.....................#........
.................#..#..#..#.................................#................#.....................#....................#..#.......
...............#......#...#....#.#..#.#......................#........##..........................##...........................#...
.............#....................#.#.........................#....#......#.............###........#...#........#....#....#........
............................#....#.............................#.............#.........##..#....#.....##...........................
..#............#.#......#.............................#.........#..#.......................#.......................................
..#........#..#....#.......#...#..........#............#....#.#.......#.............#......................##.....#................
.........##.#.............#...............................#.............................#.........................#.....#..........
..............#...#......#..###...................................#.....................................#..#...#...............#...
.....#.#...............#.........................#..............#.....#..........................#.#.............#..#......#.......
...#...###..#........#........#.............##................#....#...................................#..#...##....##.............
.....#.............#...............#..#...##.....#...................#............#..................#..##...............#.#.......
.....#....#........#.#..#.........#.........#.......#...................................#.................#.........#......#.....#.
......#...........................#....#..............#.........#.............................#.......................#.....#......
......#....#...#.......#.#......#..##...........#...........................#...#.#..#........................................##...
.....................................................#.....................#........#.......#......#........#.##.........#..#....#.
...........#.#.....#......................#...#....................................#..................#.............#......#.......
.#.....#.#.......................#......#..#................................#.......#...........##.........#....#..#......#..#.....
..........................##..#.............#........#.............................###........................#.#..........#.#.....
.....#..........#.#....................#...#......#........................#.#.....#..............##.................#.........#...
...................................................................................................................................`;
let lines = data.split("\n");
let dirs = [
  [-1, 0],
  [0, 1],
  [1, 0],
  [0, -1],
];
let grid = {};
let pos_list = new Set();

// load the map into a 5x5 array of duplicate maps
let max_row = lines.length;
let max_col = lines[0].length;
for (let line of lines) {
  for (let mult_row = 0; mult_row < 5; mult_row++) {
    for (let mult_col = 0; mult_col < 5; mult_col++) {
      for (let line_num = 0; line_num < lines.length; line_num++) {
        for (let ch_num = 0; ch_num < lines[line_num].length; ch_num++) {
          let r2 = mult_row * max_row + line_num;
          let c2 = mult_col * max_col + ch_num;
          if (lines[line_num][ch_num] === "S") {
            if (mult_row === 2 && mult_col === 2) {
              pos_list.add([r2, c2].toString());
            }
          }
          grid[[r2, c2].toString()] = lines[line_num][ch_num];
        }
      }
    }
  }
}
// console.log(lines.join("\n"));
// console.log(grid);
let max_row2 = max_row * 5;
let max_col2 = max_row * 5;

let total_steps = 26501365;
let cycles = Math.floor(total_steps / max_row);
let extra = total_steps % max_row;

console.log("");
console.log(
  `${total_steps} / ${max_row} = ${Math.floor(
    total_steps / max_row
  )} rem ${extra}`
);
console.log("");

// fill in the 5x5 array of maps
for (let steps = 0; steps < max_row * 2 + extra; steps++) {
  let pos_list2 = new Set();
  for (let pos of pos_list) {
    let [r, c] = pos.split(",").map(Number);
    for (let [dr, dc] of dirs) {
      let r2 = r + dr;
      let c2 = c + dc;
      let pos2 = [r2, c2].toString();
      if (pos2 in grid && grid[pos2] !== "#") {
        pos_list2.add(pos2);
      }
    }
  }
  pos_list = pos_list2;
}
console.log(pos_list.size);

let counts = Array.from({ length: 5 }, () => Array(5).fill(0));
for (let r1 = 0; r1 < max_row2; r1++) {
  for (let c1 = 0; c1 < max_col2; c1++) {
    let pos_str = [r1, c1].toString();
    if (pos_list.has(pos_str)) {
      counts[Math.floor(r1 / max_row)][Math.floor(c1 / max_col)] += 1;
    }
  }
}

// print counts for each map in our array
for (let row of counts) {
  console.log(row.map((col) => col.toString().padStart(5)).join(" "));
}

let answer = 0;
// 0, 0 is empty
answer += counts[0][1] * cycles;
answer += counts[0][2];
answer += counts[0][3] * cycles;
// 0, 4 is empty
// 1, 0 covered by 0, 1
answer += counts[1][1] * (cycles - 1);
// center square number part 2:
answer += counts[1][2] * Math.pow(cycles, 2);
answer += counts[1][3] * (cycles - 1);
// 1, 4 covered by 0, 3
answer += counts[2][0];
// 2, 1 covered by 1, 2
// center square number part 2:
answer += counts[2][2] * Math.pow(cycles - 1, 2);
// 2, 3 covered by 1, 2
answer += counts[2][4];
answer += counts[3][0] * cycles;
answer += counts[3][1] * (cycles - 1);
// 3, 2 covered by 1, 2
answer += counts[3][3] * (cycles - 1);
answer += counts[3][4] * cycles;
// 4, 0 is empty
// 4, 1 covered by 3, 0
answer += counts[4][2];
// 4, 3 covered by 3, 4
// 4, 4 is empty
console.log(`answer = ${answer}`);
// console.log(`check = ${pos_list.size}`);
